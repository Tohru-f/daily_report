## 取り組んだ課題一覧
- 【この動画1本でOK】Next.js 完全攻略【2025年最新 Version15】
## わかったこと
- Server componentではAsync await を支える場が、Client componentでは使えない。これによりServer componentの方がコードを短く記述できる。
- static renderingでは本番環境ではbuildした時にhtmlを生成しているので、ページを再読み込みしても表示内容は変わらない。Dynamic Renderingに変更することで表示内容が変わるように修正できる。方法としてはcookiesなどのDynamic rendering用関数を使用するか、fetch関数の第二引数に`cache: 'no-store'`を加えることで切り替えできる。
- Dynamic Renderingの表示に関してはServer componentのレンダリングが全て終わるまで初期描画されないようになっている。処理が遅い部分だけを後で表示して即座に表示できる部分を表示する場合は時間の掛かる処理部分を<Suspense>で囲む。また、<Suspense>のpropsのpropsにfallback={コンポーネント}を追記することで、読み込み中はfallback内のコンポーネントを代わりに表示する。通常使うのはServer componentが望ましい。
- データ取得などの処理はpage.tsxでは行わず、他の末端コンポーネントで行う方がベター
- Server componentをClient componentの下に置くと通常はエラーを起こす可能性があるが、childreとして呼び出せば可能になる
- Server componentで異なる２つのコンポーネントで同じURLからデータを取得する場合、１回目に取得したデータをサーバーの中にデータとして保持して、２回目の取得時はサーバーの保管データから取得して完了となる。同じURLからClient componentとしてデータ取得する処理を加えた場合、Client componentの部分は違う値を表す。
- fetch関数の部分で第二引数に`cache: 'force-cache'`のオプションが書かれているとあるURLから取得したデータはサーバー上のキャッシュに保管されて、同じURLに２回目以降アクセスする場合はサーバーに保管されているデータを表示に使われるようになる。
- ソフトナビゲーションとはブラウザの戻る、進むボタンやNext.jsのリンクボタンなど
- Client Route Cacheはブラウザのメモリ上に訪問したページのRFCペイロードを保存しておき、ソフトナビゲーション時に保存したRFCペイロードからHTMLを再構築して表示する。開発環境ではこの機能を利用することができず、本番環境だけの機能となる。ただし、キャッシュは５分経つと削除されるので、その場合は再度データ取得に時間が掛かる。また、Linkタグにセットされたページのデータを事前取得して、Linkタグがクリックされた時にRSC payloadからデータを取得する方法もある。対象のLinkページがStatic renderingがDynamic renderingかで挙動が変わる。Dynamic renderingの場合はLinkタグのpropsで`prefetch={true}`を渡すことで上述の挙動をとるようになる。
- app直下のlayout.tsxはレンダリング時の一番外側を描写するための実装内容。ディレクトリごとにもlayout.tsxを配置することが可能で、その場合は同じディレクトリにあるpage.tsxにのみ反映される。
- loadng.tsxは初期レンダリングに時間が掛かる場合に一時的に表示される画面で複数存在する場合は一番最下層のloading.tsxの内容が描写される。loading.tsxもディレクトリごとに設置することができる。
- エラーの処理について、global-error.tsxが設置されている場合、全ページでエラーが発生した場合に表示されるコンポーネントとなる。もしエラーが発生したページにerror.tsxが設置されている場合はそちらが優先される。
- middleware.ts(proxy.ts)は特定の処理の前に挟む中間処理を挟むことができる。redirectであれば、matcherに合致するURLにアクセスした場合、別のURLへリダイレクトさせることができる。
- publicは静的ファイルを配置するためのディレクトリ。`/sample.png`の記述で画像ファイルを使用できる。
- Dynamic Route Segmentsはディレクトリとして`[id]`といった名前で作り、その中に`page.tsx`を作ることで、パラメーターとしてURLからidを取得し、propsとして`page.tsx`へ渡すことができる。
- Route Groupsではディレクトリ名を`( )`で囲むことにより、ページへアクセスするURLに影響しない(入力する必要がない)ようにできる。
- Pararell Routeでは、@を付けてディレクトリを作成すると、同一階層の`layout.tsx`で@ディレクトリと同じ命名でコンポーネントを受け取ることができる。ページによって表示内容を切り替えたい場合は、@ディレクトリ以下に対象ページと同じ名前でディレクトリを作り、その中に`page.tsx`を作ることで表示を切り替えることができる。Linkタグを通じて別のページに遷移した時などに遷移先に@ディレクトリのpage.tsxが存在しない場合はリンク元の@ディレクトリにある@page.tsxの内容がそのまま引き継がれる。リロードなどのハードナビゲーションを行うと内容がリセットされる。
## 次やること
- 【この動画1本でOK】Next.js 完全攻略【2025年最新 Version15】
## 感じたこと
- Next.jsは優秀なフレームワークだけど、機能を自動実現するための制約などが多く、機能の裏でやっていることを理解しておくことが重要。ただ使えるだけではダメだ。
## 学習時間
- 6h 06min